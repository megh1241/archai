
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>archai.supergraph.nas.finalizers &#8212; Archai</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/tabs.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../getting_started/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../getting_started/package_structure.html">
   Package Structure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../getting_started/quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../getting_started/notebooks.html">
   Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../getting_started/notebooks/discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../getting_started/notebooks/discrete_search/search_space.html">
       Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../getting_started/notebooks/discrete_search/evaluators.html">
       Evaluators
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../getting_started/notebooks/discrete_search/algos.html">
       Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../getting_started/notebooks/discrete_search/config_search.html">
       Configuration-based Search
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../getting_started/notebooks/supergraph.html">
     Supergraph
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../getting_started/notebooks/cv.html">
     Computer Vision
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../getting_started/notebooks/nlp.html">
     Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../advanced_guide/nas.html">
   Neural Architecture Search
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nas/discrete_search.html">
     Discrete Search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nas/supergraph.html">
     Supergraph
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../advanced_guide/cv.html">
   Computer Vision
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/cv/datasets.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/cv/trainers.html">
     Trainers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/cv/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/cv/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../advanced_guide/nlp.html">
   Natural Language Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nlp/datasets.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nlp/trainers.html">
     Trainers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nlp/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/nlp/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../advanced_guide/cloud.html">
   Cloud-Based Search
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../advanced_guide/cloud/azure.html">
     Azure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../contributing/first_contribution.html">
   First Time Contributor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../contributing/documentation.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../contributing/unitary_tests.html">
   Unitary Tests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../support/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../support/contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../support/copyright.html">
   Copyright
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../../reference/api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../reference/api/archai.api.html">
     API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../../reference/api/archai.common.html">
     Common Packages
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.datasets.html">
     Datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.datasets.cv.html">
       Computer Vision
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.datasets.cv.transforms.html">
         Transforms
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.datasets.nlp.html">
       Natural Language Processing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.datasets.nlp.tokenizer_utils.html">
         Tokenization Utilities
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.algos.html">
       Search Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.api.html">
       API
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.evaluators.html">
       Evaluators
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.evaluators.nlp.html">
         Natural Language Processing
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.evaluators.pt_profiler_utils.html">
         PyTorch Profiler (Utilities)
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.predictors.html">
       Predictors
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.search_spaces.html">
       Search Spaces
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.search_spaces.config.html">
         Configuration-Based
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.search_spaces.natsbench_tss.html">
         NATS-Bench
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.search_spaces.nlp.html">
         Natural Language Processing
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.discrete_search.search_spaces.segmentation_dag.html">
         Segmentation DAG
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.discrete_search.utils.html">
       Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.onnx.html">
     ONNX
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.onnx.config_utils.html">
       Configuration Utilities
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.onnx.optimization_utils.html">
       Optimization Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.quantization.html">
     Quantization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.quantization.nlp.html">
       Natural Language Processing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.supergraph.html">
     Supergraph
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.html">
       Algorithms
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.darts.html">
         DARTS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.didarts.html">
         DiDARTS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.divnas.html">
         DivNAS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.gumbelsoftmax.html">
         Gumbel-Softmax
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.manual.html">
         Manual
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.nasbench101.html">
         NasBench-101
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.petridish.html">
         Petridish
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.random.html">
         Random
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.algos.xnas.html">
         XNAS
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.supergraph.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.datasets.providers.html">
         Providers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../../reference/api/archai.supergraph.models.html">
       Models
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
      <label for="toctree-checkbox-19">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../../reference/api/archai.supergraph.models.shakeshake.html">
         ShakeShake
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.supergraph.nas.html">
       Neural Architecture Search
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.supergraph.utils.html">
       Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../../reference/api/archai.trainers.html">
     Trainers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.trainers.cv.html">
       Computer Vision
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../../reference/api/archai.trainers.nlp.html">
       Natural Language Processing
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../reference/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../reference/changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/microsoft/archai"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/issues/new?title=Issue%20on%20page%20%2F_modules/archai/supergraph/nas/finalizers.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for archai.supergraph.nas.finalizers</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) Microsoft Corporation.</span>
<span class="c1"># Licensed under the MIT license.</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">overrides</span> <span class="kn">import</span> <span class="n">EnforceOverrides</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="kn">from</span> <span class="nn">archai.supergraph.nas.cell</span> <span class="kn">import</span> <span class="n">Cell</span>
<span class="kn">from</span> <span class="nn">archai.supergraph.nas.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">archai.supergraph.nas.model_desc</span> <span class="kn">import</span> <span class="n">CellDesc</span><span class="p">,</span> <span class="n">EdgeDesc</span><span class="p">,</span> <span class="n">ModelDesc</span><span class="p">,</span> <span class="n">NodeDesc</span>


<div class="viewcode-block" id="Finalizers"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers">[docs]</a><span class="k">class</span> <span class="nc">Finalizers</span><span class="p">(</span><span class="n">EnforceOverrides</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides base algorithms for finalizing model, cell and edge which can be overriden</span>

<span class="sd">    For op-level finalize, just put logic in op&#39;s finalize.</span>

<span class="sd">    For model/cell/edge level finalize, you can override the methods in this class to customize the behavior. To override any of these methods, simply create new class in your algos folder, for example, diversity/diversity_finalizers.py. In this file create class that derives from Finalizers. Then in your algos exp_runner.py, return instance of that class in its finalizers() method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Finalizers.finalize_model"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.finalize_model">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span><span class="n">Model</span><span class="p">,</span> <span class="n">to_cpu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">restore_device</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ModelDesc</span><span class="p">:</span>
        <span class="c1"># move model to CPU before finalize because each op will serialize</span>
        <span class="c1"># its parameters and we don&#39;t want copy of these parameters hanging on GPU</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">device_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">to_cpu</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

        <span class="c1"># finalize will create copy of state and this can overflow GPU RAM</span>
        <span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">device_type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span>

        <span class="n">cell_descs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_cells</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">restore_device</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelDesc</span><span class="p">(</span><span class="n">conf_model_desc</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">conf_model_desc</span><span class="p">,</span>
                         <span class="n">model_stems</span><span class="o">=</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">model_stems</span><span class="p">],</span>
                         <span class="n">pool_op</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">pool_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">cell_descs</span><span class="o">=</span><span class="n">cell_descs</span><span class="p">,</span>
                         <span class="n">aux_tower_descs</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">aux_tower_descs</span><span class="p">,</span>
                         <span class="n">logits_op</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">logits_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Finalizers.finalize_cells"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.finalize_cells">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">List</span><span class="p">[</span><span class="n">CellDesc</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">finalize_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cells</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Finalizers.finalize_cell"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.finalize_cell">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">:</span><span class="n">Cell</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                      <span class="n">model_desc</span><span class="p">:</span><span class="n">ModelDesc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CellDesc</span><span class="p">:</span>
        <span class="c1"># first finalize each node, we will need to recreate node desc with final version</span>
        <span class="n">max_final_edges</span> <span class="o">=</span> <span class="n">model_desc</span><span class="o">.</span><span class="n">max_final_edges</span>

        <span class="n">node_descs</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">NodeDesc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">dag</span><span class="p">):</span>
            <span class="n">node_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">nodes</span><span class="p">()[</span><span class="n">i</span><span class="p">],</span><span class="n">max_final_edges</span><span class="p">)</span>
            <span class="n">node_descs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_desc</span><span class="p">)</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">desc</span>
        <span class="n">finalized</span> <span class="o">=</span> <span class="n">CellDesc</span><span class="p">(</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="n">desc</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">conf_cell</span><span class="o">=</span><span class="n">desc</span><span class="o">.</span><span class="n">conf_cell</span><span class="p">,</span>
            <span class="n">stems</span><span class="o">=</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">s0_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell</span><span class="o">.</span><span class="n">s1_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">stem_shapes</span><span class="o">=</span><span class="n">desc</span><span class="o">.</span><span class="n">stem_shapes</span><span class="p">,</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">node_descs</span><span class="p">,</span> <span class="n">node_shapes</span><span class="o">=</span><span class="n">desc</span><span class="o">.</span><span class="n">node_shapes</span><span class="p">,</span>
            <span class="n">post_op</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">post_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">out_shape</span><span class="o">=</span><span class="n">desc</span><span class="o">.</span><span class="n">out_shape</span><span class="p">,</span>
            <span class="n">trainables_from</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">trainables_from</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">finalized</span></div>

<div class="viewcode-block" id="Finalizers.finalize_node"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.finalize_node">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">,</span> <span class="n">node_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                      <span class="n">node_desc</span><span class="p">:</span><span class="n">NodeDesc</span><span class="p">,</span> <span class="n">max_final_edges</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                      <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NodeDesc</span><span class="p">:</span>
        <span class="c1"># get edge ranks, if rank is None it is deemed as required</span>
        <span class="n">pre_selected</span><span class="p">,</span> <span class="n">edge_desc_ranks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge_ranks</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ranked_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_edges</span><span class="p">(</span><span class="n">edge_desc_ranks</span><span class="p">,</span> <span class="n">max_final_edges</span><span class="p">)</span>
        <span class="n">selected_edges</span> <span class="o">=</span> <span class="n">pre_selected</span> <span class="o">+</span> <span class="n">ranked_selected</span>
        <span class="k">return</span> <span class="n">NodeDesc</span><span class="p">(</span><span class="n">selected_edges</span><span class="p">,</span> <span class="n">node_desc</span><span class="o">.</span><span class="n">conv_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Finalizers.select_edges"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.select_edges">[docs]</a>    <span class="k">def</span> <span class="nf">select_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_desc_ranks</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">EdgeDesc</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
                           <span class="n">max_final_edges</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">List</span><span class="p">[</span><span class="n">EdgeDesc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_desc_ranks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_final_edges</span><span class="p">:</span>
            <span class="c1"># sort by rank and pick bottom</span>
            <span class="n">edge_desc_ranks</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">edge_desc_ranks</span> <span class="o">=</span> <span class="n">edge_desc_ranks</span><span class="p">[:</span><span class="n">max_final_edges</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">edr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">edr</span> <span class="ow">in</span> <span class="n">edge_desc_ranks</span><span class="p">]</span></div>

<div class="viewcode-block" id="Finalizers.get_edge_ranks"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.get_edge_ranks">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge_ranks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">)</span>\
            <span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EdgeDesc</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">EdgeDesc</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
        <span class="n">selected_edges</span><span class="p">,</span> <span class="n">edge_desc_ranks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">edge_desc</span><span class="p">,</span> <span class="n">rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="c1"># if rank is None then it is required rank</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">selected_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_desc</span><span class="p">)</span> <span class="c1"># required edge</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># optional edge</span>
                <span class="n">edge_desc_ranks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">edge_desc</span><span class="p">,</span> <span class="n">rank</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">selected_edges</span><span class="p">,</span> <span class="n">edge_desc_ranks</span></div>

<div class="viewcode-block" id="Finalizers.finalize_edge"><a class="viewcode-back" href="../../../../reference/api/archai.supergraph.nas.html#archai.supergraph.nas.finalizers.Finalizers.finalize_edge">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">EdgeDesc</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="n">op_desc</span><span class="p">,</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">_op</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">EdgeDesc</span><span class="p">(</span><span class="n">op_desc</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">input_ids</span><span class="p">),</span> <span class="n">rank</span><span class="p">)</span></div></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft<br/>
  
      &copy; Copyright 2023.<br/>
    Last updated on Feb 02, 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>